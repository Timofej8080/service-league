<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Сервисная Лига — VK Bridge</title>
  <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #0f172a;
      color: #f1f5f9;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .card {
      background: #1e293b;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      text-align: center;
      width: 400px;
    }
    h1 { margin-bottom: 10px; font-size: 24px; }
    .username { margin-bottom: 30px; color: #94a3b8; font-weight: 600; font-size: 18px; }
    button {
      background: #3b82f6;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover { background: #2563eb; }
  </style>
</head>
<body>

  <div class="card">
    <h1>Сервисная Лига</h1>
    <div class="username" id="nickname">Загрузка...</div>
    <p>Добро пожаловать в тренировочную поддержку!</p>
    <p>Ваша задача — корректно и профессионально отвечать на обращения клиентов.</p>
    <button onclick="startShift()">Начать смену</button>
  </div>

  <script>
    const vkBridge = window.vkBridge;

    // Инициализация VK Bridge
    vkBridge.send('VKWebAppInit');

    // Генерация ника (слоги + число)
    function generateName() {
      const syllables = ["uni", "gor", "mor", "lex", "nor", "zir", "vel", "rex", "tron", "ex", "ka", "tor", "nim", "lan"];
      let name = "";
      for (let i = 0; i < 3; i++) {
        name += syllables[Math.floor(Math.random() * syllables.length)];
      }
      return name.charAt(0).toUpperCase() + name.slice(1);
    }
    function generateNumber() {
      return Math.floor(Math.random() * 600) + 1;
    }

    // Получаем данные из VK Storage
    async function getUserData() {
      try {
        const response = await vkBridge.send('VKWebAppStorageGet', { keys: ['userData'] });
        if (response.keys && response.keys.length > 0) {
          const stored = response.keys[0].value;
          return stored ? JSON.parse(stored) : null;
        }
      } catch(e) {
        console.error('Ошибка получения данных из Storage', e);
      }
      return null;
    }

    // Сохраняем данные в VK Storage
    async function setUserData(userData) {
      try {
        await vkBridge.send('VKWebAppStorageSet', { key: 'userData', value: JSON.stringify(userData) });
      } catch(e) {
        console.error('Ошибка сохранения данных в Storage', e);
      }
    }

    async function initUser() {
      let userData = await getUserData();
      if (!userData) {
        userData = {
          nickname: `${generateName()}#${generateNumber()}`
        };
        await setUserData(userData);
      }
      return userData.nickname;
    }

    // Инициализация и отображение ника
    initUser().then(nickname => {
      document.getElementById('nickname').textContent = nickname;
    });

    function startShift() {
      alert('Смена началась! (пока заглушка)');
    }
  </script>

</body>
</html>
