<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Сервисная Лига</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      background: #0f172a;
      color: #f1f5f9;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .card {
      background: #1e293b;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      text-align: center;
      width: 400px;
    }
    h1 {
      margin-bottom: 10px;
      font-size: 24px;
    }
    .username {
      margin-bottom: 30px;
      color: #94a3b8;
      font-weight: 600;
      font-size: 18px;
    }
    button {
      background: #3b82f6;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #2563eb;
    }
  </style>
</head>
<body>

  <div class="card">
    <h1>Сервисная Лига</h1>
    <div class="username" id="nickname">Загрузка...</div>
    <p>Добро пожаловать в тренировочную поддержку!</p>
    <p>Ваша задача — корректно и профессионально отвечать на обращения клиентов.</p>
    <button onclick="startShift()">Начать смену</button>
  </div>

  <script>
    // Проверяем, что VK API доступен
    if (!window.VK) {
      document.getElementById('nickname').textContent = 'Ошибка: VK API не загружен';
    }

    // Инициализация VK API (если нужно, в мини-приложении обычно уже инициализирован)
    VK.init(() => {
      initUser().then(nickname => {
        document.getElementById('nickname').textContent = nickname;
      });
    }, error => {
      document.getElementById('nickname').textContent = 'Ошибка инициализации VK API';
      console.error('VK init failed', error);
    });

    // Генерация рандомного ника из слогов (без готового списка, с рандомом)
    function generateName() {
      const syllables = ["uni", "gor", "mor", "lex", "nor", "zir", "vel", "rex", "tron", "ex", "ka", "tor", "nim", "lan"];
      let name = "";
      for (let i = 0; i < 3; i++) {
        name += syllables[Math.floor(Math.random() * syllables.length)];
      }
      return name.charAt(0).toUpperCase() + name.slice(1);
    }

    function generateNumber() {
      return Math.floor(Math.random() * 600) + 1;
    }

    // Получение данных пользователя из VK Storage
    function getUserData() {
      return new Promise(resolve => {
        VK.Storage.get('userData', (data) => {
          if (data && data.value) {
            try {
              resolve(JSON.parse(data.value));
            } catch {
              resolve(null);
            }
          } else {
            resolve(null);
          }
        });
      });
    }

    // Сохранение данных пользователя в VK Storage
    function setUserData(userData) {
      return new Promise(resolve => {
        VK.Storage.set({key: 'userData', value: JSON.stringify(userData)}, () => {
          resolve();
        });
      });
    }

    // Инициализация пользователя: получение или создание ника
    async function initUser() {
      let userData = await getUserData();
      if (!userData) {
        userData = {
          nickname: `${generateName()}#${generateNumber()}`
        };
        await setUserData(userData);
      }
      return userData.nickname;
    }

    function startShift() {
      alert('Смена началась! (пока заглушка)');
    }
  </script>

</body>
</html>
