<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–°–µ—Ä–≤–∏—Å–Ω–∞—è –õ–∏–≥–∞ ‚Äî VK Bridge</title>
  <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

    /* –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #1a202c, #0f172a);
      color: #e0e7ff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .card {
      background: #1e293b;
      padding: 36px 40px 40px 40px;
      border-radius: 18px;
      box-shadow: 0 8px 24px rgba(50, 50, 93, 0.25), 0 4px 16px rgba(0, 0, 0, 0.3);
      text-align: center;
      width: 420px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
    h1, h2, h3 {
      margin: 0 0 20px 0;
      font-weight: 600;
      color: #cbd5e1;
      text-shadow: 0 1px 3px rgba(0,0,0,0.4);
    }

    h1 {
      font-size: 28px;
    }
    h2 {
      font-size: 22px;
    }
    h3 {
      font-size: 18px;
    }

    /* –ù–∏–∫–Ω–µ–π–º */
    .username {
      margin-bottom: 35px;
      color: #94a3b8;
      font-weight: 700;
      font-size: 20px;
      letter-spacing: 0.05em;
      user-select: none;
    }

    /* –ü–∞—Ä–∞–≥—Ä–∞—Ñ—ã */
    p {
      margin: 0 0 18px 0;
      line-height: 1.5;
      color: #a0aec0;
      font-size: 15px;
    }

    /* –ö–Ω–æ–ø–∫–∏ */
    button {
      background: #3b82f6;
      border: none;
      padding: 14px 28px;
      border-radius: 12px;
      color: #f1f5f9;
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease, box-shadow 0.25s ease;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.6);
      user-select: none;
      margin-bottom: 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    button:hover {
      background: #2563eb;
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.8);
    }
    button:active {
      background: #1e40af;
      box-shadow: 0 3px 8px rgba(30, 64, 175, 0.9);
      transform: translateY(1px);
    }

    /* –°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤ */
    #tickets-list {
      overflow-y: auto;
      max-height: 230px;
      margin-bottom: 28px;
      border-radius: 12px;
      background: #334155;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
      padding: 12px 8px;
      scrollbar-width: thin;
      scrollbar-color: #60a5fa #1e293b;
    }
    #tickets-list::-webkit-scrollbar {
      width: 10px;
    }
    #tickets-list::-webkit-scrollbar-track {
      background: #1e293b;
      border-radius: 12px;
    }
    #tickets-list::-webkit-scrollbar-thumb {
      background-color: #60a5fa;
      border-radius: 12px;
      border: 2px solid #1e293b;
    }

    #tickets-list button {
      background: #2563eb;
      width: 100%;
      text-align: left;
      padding: 14px 16px;
      margin-bottom: 12px;
      font-size: 15px;
      border-radius: 10px;
      font-weight: 600;
      color: #e0e7ff;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.6);
      transition: background-color 0.25s ease;
    }
    #tickets-list button:hover:not(.answered) {
      background: #3b82f6;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.8);
    }
    #tickets-list button.answered {
      background: #22c55e;
      color: #0f172a;
      text-decoration: line-through;
      box-shadow: 0 2px 8px rgba(34, 197, 94, 0.7);
      cursor: default;
    }

    /* –î–µ—Ç–∞–ª–∏ —Ç–∏–∫–µ—Ç–∞ */
    #ticket-details {
      text-align: left;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    #client-message {
      background:#475569;
      padding: 16px;
      border-radius: 14px;
      min-height: 70px;
      margin-bottom: 18px;
      color: #e2e8f0;
      font-size: 15px;
      white-space: pre-wrap;
      box-shadow: inset 0 0 8px rgba(0,0,0,0.2);
    }

    textarea {
      resize: none;
      font-family: 'Inter', sans-serif;
      font-size: 15px;
      padding: 14px;
      border-radius: 14px;
      border: none;
      margin-bottom: 18px;
      width: 100%;
      box-sizing: border-box;
      box-shadow: 0 0 12px rgba(59, 130, 246, 0.3);
      transition: box-shadow 0.3s ease;
      color: #f1f5f9;
      background: #1e293b;
    }
    textarea:focus {
      outline: none;
      box-shadow: 0 0 20px #3b82f6;
      background: #293544;
    }

    #send-answer {
      background: #10b981;
      box-shadow: 0 5px 15px rgba(16, 185, 129, 0.7);
    }
    #send-answer:hover {
      background: #059669;
      box-shadow: 0 7px 18px rgba(5, 150, 105, 0.8);
    }
    #send-answer:active {
      background: #047857;
      box-shadow: 0 3px 10px rgba(4, 120, 87, 0.9);
      transform: translateY(1px);
    }

    #end-shift {
      background: #ef4444;
      margin-top: auto;
      font-weight: 700;
      box-shadow: 0 5px 18px rgba(239, 68, 68, 0.7);
    }
    #end-shift:hover {
      background: #b91c1c;
      box-shadow: 0 7px 20px rgba(185, 28, 28, 0.85);
    }
    #end-shift:active {
      background: #7f1d1d;
      box-shadow: 0 3px 12px rgba(127, 29, 29, 1);
      transform: translateY(1px);
    }
  </style>
</head>
<body>

  <!-- –≠–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è -->
  <div id="welcome-screen" class="card" role="main" aria-label="–≠–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è">
    <h1>–°–µ—Ä–≤–∏—Å–Ω–∞—è –õ–∏–≥–∞</h1>
    <div class="username" id="nickname" aria-live="polite">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É!</p>
    <p>–í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤.</p>
    <button id="start-shift-btn" aria-label="–ù–∞—á–∞—Ç—å —Å–º–µ–Ω—É">üöÄ –ù–∞—á–∞—Ç—å —Å–º–µ–Ω—É</button>
  </div>

  <!-- –†–∞–±–æ—á–∏–π —ç–∫—Ä–∞–Ω -->
  <div id="work-screen" class="card" style="display:none;" role="main" aria-label="–†–∞–±–æ—á–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å">
    <h2>–†–∞–±–æ—á–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h2>
    <div id="tickets-list" aria-label="–°–ø–∏—Å–æ–∫ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–æ–≤" tabindex="0"></div>

    <div id="ticket-details" style="text-align:left;">
      <h3>–î–µ—Ç–∞–ª–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è</h3>
      <p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞:</strong></p>
      <p id="client-message" style="background:#334155; padding: 12px; border-radius: 8px; min-height: 60px;" aria-live="polite"></p>
      <p><strong>–í–∞—à –æ—Ç–≤–µ—Ç:</strong></p>
      <textarea id="answer-text" rows="4" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–≤–µ—Ç..." aria-label="–ü–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –æ—Ç–≤–µ—Ç–∞"></textarea>
      <button id="send-answer" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç</button>
    </div>

    <button id="end-shift" aria-label="–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–º–µ–Ω—É">‚è∞ –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–º–µ–Ω—É</button>
  </div>

  <script>
    const vkBridge = window.vkBridge;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VK Bridge
    vkBridge.send('VKWebAppInit');

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∏–∫–∞ (—Å–ª–æ–≥–∏ + —á–∏—Å–ª–æ)
    function generateName() {
      const syllables = ["uni", "gor", "mor", "lex", "nor", "zir", "vel", "rex", "tron", "ex", "ka", "tor", "nim", "lan"];
      let name = "";
      for (let i = 0; i < 3; i++) {
        name += syllables[Math.floor(Math.random() * syllables.length)];
      }
      return name.charAt(0).toUpperCase() + name.slice(1);
    }
    function generateNumber() {
      return Math.floor(Math.random() * 600) + 1;
    }

    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ VK Storage
    async function getUserData() {
      try {
        const response = await vkBridge.send('VKWebAppStorageGet', { keys: ['nickname'] });
        if (response.keys.length > 0 && response.keys[0].value) {
          return response.keys[0].value;
        }
      } catch(e) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–∏–∫–∞:', e);
      }
      return null;
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∏–∫
    async function saveNickname(nick) {
      try {
        await vkBridge.send('VKWebAppStorageSet', { key: 'nickname', value: nick });
      } catch(e) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∏–∫–∞:', e);
      }
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∏–∫–Ω–µ–π–º
    async function loadNickname() {
      let nick = await getUserData();
      if (!nick) {
        nick = generateName() + generateNumber();
        await saveNickname(nick);
      }
      document.getElementById('nickname').textContent = nick;
    }

    // –ú–æ–∫–æ–≤—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è
    const tickets = [
      { id: 1, message: "–ù–µ –º–æ–≥—É –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç, –ø–æ–º–æ–≥–∏—Ç–µ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞.", answered: false, answer: "" },
      { id: 2, message: "–ü–æ—á–µ–º—É –º–æ–π –∑–∞–∫–∞–∑ –∑–∞–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è?", answered: false, answer: "" },
      { id: 3, message: "–ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏?", answered: true, answer: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –∏–∑–º–µ–Ω–∏—Ç—å –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –º–æ–∂–Ω–æ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ." },
      { id: 4, message: "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—ã–ª–µ—Ç–∞–µ—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.", answered: false, answer: "" },
      { id: 5, message: "–ì–¥–µ –Ω–∞–π—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π?", answered: true, answer: "–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ—Ñ–∏–ª—è –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è'." }
    ];

    let currentTicketId = null;

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤
    function renderTickets() {
      const container = document.getElementById('tickets-list');
      container.innerHTML = '';
      tickets.forEach(ticket => {
        const btn = document.createElement('button');
        btn.textContent = (ticket.answered ? "‚úîÔ∏è " : "‚ùó ") + ticket.message;
        btn.className = ticket.answered ? 'answered' : '';
        btn.disabled = ticket.answered;
        btn.onclick = () => {
          if (!ticket.answered) {
            currentTicketId = ticket.id;
            showTicketDetails(ticket);
          }
        };
        container.appendChild(btn);
      });
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –æ–±—Ä–∞—â–µ–Ω–∏—è
    function showTicketDetails(ticket) {
      document.getElementById('client-message').textContent = ticket.message;
      document.getElementById('answer-text').value = ticket.answer || '';
      document.getElementById('answer-text').focus();
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞
    function sendAnswer() {
      const answerInput = document.getElementById('answer-text');
      if (!currentTicketId) {
        alert('–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –¥–ª—è –æ—Ç–≤–µ—Ç–∞.');
        return;
      }
      const answerText = answerInput.value.trim();
      if (!answerText) {
        alert('–û—Ç–≤–µ—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.');
        return;
      }
      const ticket = tickets.find(t => t.id === currentTicketId);
      ticket.answer = answerText;
      ticket.answered = true;
      currentTicketId = null;
      answerInput.value = '';
      renderTickets();
      clearTicketDetails();
    }

    // –û—á–∏—Å—Ç–∫–∞ –¥–µ—Ç–∞–ª–µ–π –æ–±—Ä–∞—â–µ–Ω–∏—è
    function clearTicketDetails() {
      document.getElementById('client-message').textContent = '';
      document.getElementById('answer-text').value = '';
    }

    // –ù–∞—á–∞—Ç—å —Å–º–µ–Ω—É
    document.getElementById('start-shift-btn').onclick = () => {
      document.getElementById('welcome-screen').style.display = 'none';
      document.getElementById('work-screen').style.display = 'flex';
      renderTickets();
    };

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É
    document.getElementById('send-answer').onclick = sendAnswer;

    // –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–º–µ–Ω—É ‚Äî –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É (–º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å)
    document.getElementById('end-shift').onclick = () => {
      if (confirm('–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–º–µ–Ω—É? –í—Å–µ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.')) {
        location.reload();
      }
    };

    loadNickname();
  </script>
</body>
</html>
